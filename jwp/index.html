<!DOCTYPE html>
<html lang="en" class="Individual-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Json Web Proofs for Binary Merkle Trees</title>
<meta content="Orie Steele" name="author">
<meta content="Michael Prorock" name="author">
<meta content="
       Merkle proofs are already being used to provide certificate transparency in  . 
       The purpose of this specification is to define a  generic  encoding of merkle audit paths that is suitable for combining with   to construct selective disclosure proofs, that are not bound to the needs of certificate transparency, and that are suitable for more generic applications such as  W3C Verifiable Credentials  and  W3C Decentralized Identifiers . 
    " name="description">
<meta content="xml2rfc 3.12.0" name="generator">
<meta content="jwp-bmt-00" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.12.0
    Python 3.10.1
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.7.1
    pycountry 20.7.3
    pyflakes 2.4.0
    PyYAML 6.0
    requests 2.26.0
    setuptools 57.5.0
    six 1.16.0
-->
<link href="./jwp-bmt-00.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left"></td>
<td class="center">JWP-BMT</td>
<td class="right">January 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Steele &amp; Prorock</td>
<td class="center">Informational</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">none</dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">O. Steele</div>
<div class="org">Transmute</div>
</div>
<div class="author">
      <div class="author-name">M. Prorock</div>
<div class="org">mesur.io</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Json Web Proofs for Binary Merkle Trees</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">Merkle proofs are already being used to provide certificate transparency in <span>[<a href="#RFC9162" class="xref">RFC9162</a>]</span>.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2">The purpose of this specification is to define a <strong>generic</strong> encoding of merkle audit paths that is suitable for combining with <span>[<a href="#RFC7515" class="xref">RFC7515</a>]</span> to construct selective disclosure proofs, that are not bound to the needs of certificate transparency, and that are suitable for more generic applications such as <a href="https://www.w3.org/TR/vc-data-model/">W3C Verifiable Credentials</a> and <a href="https://www.w3.org/TR/did-core/">W3C Decentralized Identifiers</a>.<a href="#section-abstract-2" class="pilcrow">¶</a></p>
</section>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-notational-conventions" class="xref">Notational Conventions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-terminology" class="xref">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-overview" class="xref">Overview</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-k-ary-merkle-trees" class="xref">K-ary Merkle Trees</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-comparison-with-rfc9162" class="xref">Comparison with RFC9162</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.1">
                    <p id="section-toc.1-1.2.2.2.2.1.1"><a href="#section-2.2.1" class="xref">2.2.1</a>.  <a href="#name-tree-construction" class="xref">Tree Construction</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.2">
                    <p id="section-toc.1-1.2.2.2.2.2.1"><a href="#section-2.2.2" class="xref">2.2.2</a>.  <a href="#name-agility-for-hash-algorithms" class="xref">Agility for Hash Algorithms</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.3">
                    <p id="section-toc.1-1.2.2.2.2.3.1"><a href="#section-2.2.3" class="xref">2.2.3</a>.  <a href="#name-agility-for-signature-algor" class="xref">Agility for Signature Algorithms</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-comparison-with-bbs-signatu" class="xref">Comparison with BBS+ Signatures</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="xref">2.4</a>.  <a href="#name-agility-for-hash-algorithms-2" class="xref">Agility for Hash Algorithms</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.5">
                <p id="section-toc.1-1.2.2.5.1"><a href="#section-2.5" class="xref">2.5</a>.  <a href="#name-agility-for-signature-algori" class="xref">Agility for Signature Algorithms</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-tree-constuction" class="xref">Tree Constuction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-encoding" class="xref">Encoding</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-binary" class="xref">Binary</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="xref">4.1.1</a>.  <a href="#name-merkle-audit-paths" class="xref">Merkle Audit Paths</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="xref">4.1.2</a>.  <a href="#name-encoding-membership-proofs" class="xref">Encoding Membership Proofs</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-authenticated-full-disclosu" class="xref">Authenticated Full Disclosure Proof</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.1">
                    <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="xref">4.2.1</a>.  <a href="#name-jose" class="xref">JOSE</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.2">
                    <p id="section-toc.1-1.4.2.2.2.2.1"><a href="#section-4.2.2" class="xref">4.2.2</a>.  <a href="#name-cose" class="xref">COSE</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-authenticated-selective-dis" class="xref">Authenticated Selective Disclosure Proof</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.1">
                    <p id="section-toc.1-1.4.2.3.2.1.1"><a href="#section-4.3.1" class="xref">4.3.1</a>.  <a href="#name-jose-2" class="xref">JOSE</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.2">
                    <p id="section-toc.1-1.4.2.3.2.2.1"><a href="#section-4.3.2" class="xref">4.3.2</a>.  <a href="#name-cose-2" class="xref">COSE</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-validating-public-keys" class="xref">Validating Public Keys</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-disclosure-of-root-nonce" class="xref">Disclosure of Root Nonce</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-forgery-attacks-on-unbalanc" class="xref">Forgery Attacks on Unbalanced Binary Merkle Trees</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="xref">5.4</a>.  <a href="#name-side-channel-attacks" class="xref">Side Channel Attacks</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5">
                <p id="section-toc.1-1.5.2.5.1"><a href="#section-5.5" class="xref">5.5</a>.  <a href="#name-randomness-considerations" class="xref">Randomness Considerations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.6">
                <p id="section-toc.1-1.5.2.6.1"><a href="#section-5.6" class="xref">5.6</a>.  <a href="#name-choice-of-hash-primitive" class="xref">Choice of Hash Primitive</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.7">
                <p id="section-toc.1-1.5.2.7.1"><a href="#section-5.7" class="xref">5.7</a>.  <a href="#name-choice-of-signature-primiti" class="xref">Choice of Signature Primitive</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-appendix" class="xref">Appendix</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-test-vectors" class="xref">Test Vectors</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-A" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The scheme described herin features many important properties:<a href="#section-1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-1-2">
<li id="section-1-2.1">Defined deterministic nonce generation for membership proofs, to protect against second pre-image attacks.<a href="#section-1-2.1" class="pilcrow">¶</a>
</li>
        <li id="section-1-2.2">Defined encoding of binary packed sets of merkle audit paths suitable for expression in JSON.<a href="#section-1-2.2" class="pilcrow">¶</a>
</li>
        <li id="section-1-2.3">Defined compression of sets of audit paths to reduce data redundancy for sparse redactions under selective disclosure schemes.<a href="#section-1-2.3" class="pilcrow">¶</a>
</li>
        <li id="section-1-2.4">Defined verification of merkle proofs combined with detached JWS as specified by <span>[<a href="#RFC7797" class="xref">RFC7797</a>]</span>.<a href="#section-1-2.4" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-1-3">These properties allow the scheme to be used in applications where privacy and data minimization techniques are desired and/or required.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">This scheme is meant to expose interfaces compatible with <a href="https://mattrglobal.github.io/bbs-signatures-spec/">BBS+ Signature Scheme</a>.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">Many of the same benefits from that scheme apply here:<a href="#section-1-5" class="pilcrow">¶</a></p>
<blockquote id="section-1-6">
        <p id="section-1-6.1">A recent emerging use case applies signature schemes in <a href="https://www.w3.org/TR/vc-data-model/">verifiable credentials</a>. One problem with using simple signature schemes like ECSDA or ED25519 is a holder must disclose the entire signed message and signature for verification. Circuit based logic can be applied to verify these in zero-knowledge like SNARKS or Bulletproofs with R1CS but tend to be complicated. BBS+ on the other hand adds, to verifiable credentials or any other application, the ability to do very efficient zero-knowledge proofs. A holder gains the ability to choose which claims to reveal to a relying party without the need for any additional complicated logic.<a href="#section-1-6.1" class="pilcrow">¶</a></p>
</blockquote>
<div id="notational-conventions">
<section id="section-1.1">
        <h3 id="name-notational-conventions">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-notational-conventions" class="section-name selfRef">Notational Conventions</a>
        </h3>
<p id="section-1.1-1">The keywords <span class="bcp14">MUST</span>, <span class="bcp14">MUST NOT</span>, <span class="bcp14">REQUIRED</span>, <span class="bcp14">SHALL</span>, <span class="bcp14">SHALL NOT</span>, <span class="bcp14">SHOULD</span>,
<span class="bcp14">SHOULD NOT</span>, <span class="bcp14">RECOMMENDED</span>, <span class="bcp14">MAY</span>, and <span class="bcp14">OPTIONAL</span>, when they appear in this
document, are to be interpreted as described in <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span>.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="terminology">
<section id="section-1.2">
        <h3 id="name-terminology">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.2-1">We will rely on the general terminology defined in <span>[<a href="#RFC7515" class="xref">RFC7515</a>]</span>, <span>[<a href="#RFC7797" class="xref">RFC7797</a>]</span> and concepts defined in <span>[<a href="#RFC9162" class="xref">RFC9162</a>]</span>.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<p id="section-1.2-2">We introduce primarily 2 new concepts needed to generalize authenticated set membership proofs based on binary merkle trees.<a href="#section-1.2-2" class="pilcrow">¶</a></p>
<p id="section-1.2-3">The following terminology is used throughout this document:<a href="#section-1.2-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-1.2-4">
          <dt id="section-1.2-4.1">Full Disclosure Proof</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-4.2">A data structure that represents all members in a set, and all proofs of membership<a href="#section-1.2-4.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-4.3">Selective Disclosure Proof</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-4.4">A data structure that represents a non-strict subset of a FullDisclosureProof.<a href="#section-1.2-4.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-4.5">Root Nonce</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-4.6">A source of entropy that when combined with a suitable cryptographic hash function is sufficient to prevent brute force attacks on siblings of disclosed members.<a href="#section-1.2-4.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-4.7">Calculate Member Nonce</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-4.8">A function for assigning nonces to members based on their order, Root Nonce, and the chosen hash function. Example provided below in typescript.<a href="#section-1.2-4.8" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<div id="section-1.2-5">
<pre class="lang-ts sourcecode">const calculateMessageNonce = (
  message: Buffer,
  index: number,
  rootNonce: Buffer,
  hash: Function
) =&gt; {
  const encodedIndex = Buffer.from(varint.encode(index));
  return hash(Buffer.concat([message, encodedIndex, rootNonce]));
};
</pre><a href="#section-1.2-5" class="pilcrow">¶</a>
</div>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-1.2-6">
          <dt id="section-1.2-6.1">Salted Member</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-6.2">The hash of a member bytes and its <code>memberNonce</code> under a chosen cryptographic hash function. These values represent the leaves of a binary merkle tree that encodes membership proofs for salted members.<a href="#section-1.2-6.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-6.3">Binary Merkle Tree of Salted Members</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-6.4">The binary merkle tree produced through concatonation, and hashing of <code>Salted Members</code><a href="#section-1.2-6.4" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="overview">
<section id="section-2">
      <h2 id="name-overview">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
      </h2>
<div id="k-ary-merkle-trees">
<section id="section-2.1">
        <h3 id="name-k-ary-merkle-trees">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-k-ary-merkle-trees" class="section-name selfRef">K-ary Merkle Trees</a>
        </h3>
<p id="section-2.1-1">We restrict this specification to Binary (2-ary) Merkle Trees.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">In short, increasing the branching factor of the merkle tree above 2 does not yield the desired properties.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.1-3">See <a href="https://math.mit.edu/research/highschool/primes/materials/2018/Kuszmaul.pdf">Verkle Trees</a>.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.1-4">See <a href="https://eprint.iacr.org/2011/495.pdf">Vector Commitments and their Applications</a>.<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<p id="section-2.1-5">See <a href="https://www.iacr.org/archive/eurocrypt2008/49650430/49650430.pdf">Zero-Knowledge Sets with short proofs</a>.<a href="#section-2.1-5" class="pilcrow">¶</a></p>
<p id="section-2.1-6">Vector commitment schemes are not defined in this specification,
however we believe that some similar approach using them would be worth considering in future work.<a href="#section-2.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="comparison-with-rfc9162">
<section id="section-2.2">
        <h3 id="name-comparison-with-rfc9162">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-comparison-with-rfc9162" class="section-name selfRef">Comparison with RFC9162</a>
        </h3>
<div id="tree-construction">
<section id="section-2.2.1">
          <h4 id="name-tree-construction">
<a href="#section-2.2.1" class="section-number selfRef">2.2.1. </a><a href="#name-tree-construction" class="section-name selfRef">Tree Construction</a>
          </h4>
<p id="section-2.2.1-1">The most obvious difference is the limitations imposed on tree construction that differ from the construction of tree's used by Bitcoin.<a href="#section-2.2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.2.1-2">See <a href="https://datatracker.ietf.org/doc/html/rfc9162#section-2.1.1">RFC9162 Definition of the Merkle Tree</a>.<a href="#section-2.2.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="agility-for-hash-algorithms">
<section id="section-2.2.2">
          <h4 id="name-agility-for-hash-algorithms">
<a href="#section-2.2.2" class="section-number selfRef">2.2.2. </a><a href="#name-agility-for-hash-algorithms" class="section-name selfRef">Agility for Hash Algorithms</a>
          </h4>
<p id="section-2.2.2-1"><span>[<a href="#RFC9162" class="xref">RFC9162</a>]</span> refer to the IANA registry for <a href="https://datatracker.ietf.org/doc/html/rfc9162#section-10.2.1">Hash Algorithms</a><a href="#section-2.2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2.2-2">But only define support for <a href="https://oidref.com/2.16.840.1.101.3.4.2.1">SHA-256</a><a href="#section-2.2.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="agility-for-signature-algorithms">
<section id="section-2.2.3">
          <h4 id="name-agility-for-signature-algor">
<a href="#section-2.2.3" class="section-number selfRef">2.2.3. </a><a href="#name-agility-for-signature-algor" class="section-name selfRef">Agility for Signature Algorithms</a>
          </h4>
<p id="section-2.2.3-1"><span>[<a href="#RFC9162" class="xref">RFC9162</a>]</span> refer to IANA registry for <a href="https://datatracker.ietf.org/doc/html/rfc9162#section-10.2.2">Signature Algorithms</a><a href="#section-2.2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.2.3-2">But only define support for a few signature algorithms:<a href="#section-2.2.3-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.3-3.1">ecdsa_secp256r1_sha256<a href="#section-2.2.3-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.2.3-3.2">ecdsa_secp256r1_sha256<a href="#section-2.2.3-3.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.2.3-3.3">ed25519<a href="#section-2.2.3-3.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-2.2.3-4">We prefer to generalize and enable support the full range of algorithms availabe under <a href="https://www.iana.org/assignments/jose/jose.xhtml">jose</a>.<a href="#section-2.2.3-4" class="pilcrow">¶</a></p>
<p id="section-2.2.3-5">We believe choices regarding agility should be handled at a higher layer, but agree that restriction is a best practice.<a href="#section-2.2.3-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="comparison-with-bbs-signatures">
<section id="section-2.3">
        <h3 id="name-comparison-with-bbs-signatu">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-comparison-with-bbs-signatu" class="section-name selfRef">Comparison with BBS+ Signatures</a>
        </h3>
<p id="section-2.3-1">BBS+ Signatures are in the process of being standardized.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3-2">Refer to <a href="https://mattrglobal.github.io/bbs-signatures-spec/">Editors Draft of BBS+ Signature Scheme</a> for details.<a href="#section-2.3-2" class="pilcrow">¶</a></p>
<p id="section-2.3-3">At a high level, we are seeking a larger degree of agility at both the hash and digital signature layers.<a href="#section-2.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="agility-for-hash-algorithms-1">
<section id="section-2.4">
        <h3 id="name-agility-for-hash-algorithms-2">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-agility-for-hash-algorithms-2" class="section-name selfRef">Agility for Hash Algorithms</a>
        </h3>
<p id="section-2.4-1">We believe that Blake2b as defined in <span>[<a href="#RFC7693" class="xref">RFC7693</a>]</span> is the only supported hash algorithm.<a href="#section-2.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="agility-for-signature-algorithms-1">
<section id="section-2.5">
        <h3 id="name-agility-for-signature-algori">
<a href="#section-2.5" class="section-number selfRef">2.5. </a><a href="#name-agility-for-signature-algori" class="section-name selfRef">Agility for Signature Algorithms</a>
        </h3>
<p id="section-2.5-1">We believe that BLS signature over BLS12381 as defined in <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-pairing-friendly-curves-10">Pairing-Friendly Curves</a>, are the only supported signature scheme.<a href="#section-2.5-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="tree-constuction">
<section id="section-3">
      <h2 id="name-tree-constuction">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-tree-constuction" class="section-name selfRef">Tree Constuction</a>
      </h2>
<p id="section-3-1">Binary Merkle Trees are constructed via the following algorithm:<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">See <a href="https://github.com/transmute-industries/verifiable-data/blob/main/packages/merkle-proof/src/index.ts#L179">compute tree</a><a href="#section-3-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3-3">
<pre>let salted_members be the series defined by hashing the concatonation of each member bytes with its member nonce.
let salted_members be the first level of a binary merkle tree, where each salted member is a leaf.
for each pair of 2 leaves in the first level of the merkle tree, concatonate the leave and hash the result yielding the next first level of the merkle tree.
if the first level of the tree is odd AND its length is not 1 (the end state), promote the odd leaf to the next leve and repeat the process.
The algorithm ends when the first level of the merkle tree has length 1, its single element is the merkle root.
</pre><a href="#section-3-3" class="pilcrow">¶</a>
</div>
<p id="section-3-4">Here is a simple visualizaton of a tree constructed in this manner:<a href="#section-3-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3-5">
<pre>      h(h(h(sm0+sm1) + h(sm2+sm3)) + sm4) (merkle root)
      /                         \
    h(h(sm0+sm1) + h(sm2+sm3))  sm4 (2 siblings)
    /          \                /
   h(sm0+sm1)   h(sm2+sm3)   sm4 (3 siblings)
  /   \        /   \         /
sm0   sm1   sm2    sm3      sm4 (leaves are the base level, 5 siblings)
^     ^     ^      ^        ^
|     |     |      |        |
m0    m1    m2     m3       m4
</pre><a href="#section-3-5" class="pilcrow">¶</a>
</div>
<p id="section-3-6">Note that this tree is "unbalanced" See <a href="#name-forgery-attacks-on-unbalanced-binary-merkle-trees">Forgery Attacks on Unbalanced Binary Merkle Trees</a>.<a href="#section-3-6" class="pilcrow">¶</a></p>
<p id="section-3-7">Also note that this algorithm differs from the one proposed in <a href="https://datatracker.ietf.org/doc/html/rfc9162#section-2.1.1">RFC9162</a>.<a href="#section-3-7" class="pilcrow">¶</a></p>
<p id="section-3-8">The reason for this difference arises from our desire to support merkle trees and proofs used by <a href="https://bitcoin.stackexchange.com/questions/69018/merkle-root-and-merkle-proofs">Bitcoin</a>, and our desire to encode a generic merkle proof that is not bound to "Certificate Transparency".<a href="#section-3-8" class="pilcrow">¶</a></p>
<p id="section-3-9">However, we may adjust the algorithm to match the one described in <span>[<a href="#RFC9162" class="xref">RFC9162</a>]</span> in the future.<a href="#section-3-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="encoding">
<section id="section-4">
      <h2 id="name-encoding">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-encoding" class="section-name selfRef">Encoding</a>
      </h2>
<div id="binary">
<section id="section-4.1">
        <h3 id="name-binary">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-binary" class="section-name selfRef">Binary</a>
        </h3>
<div id="merkle-audit-paths">
<section id="section-4.1.1">
          <h4 id="name-merkle-audit-paths">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-merkle-audit-paths" class="section-name selfRef">Merkle Audit Paths</a>
          </h4>
<p id="section-4.1.1-1">In order to verify that member bytes are included in a merkle root, a verifier requires:<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-4.1.1-2">
<li id="section-4.1.1-2.1">A nonce for the member bytes to protect against second pre-image attacks.<a href="#section-4.1.1-2.1" class="pilcrow">¶</a>
</li>
            <li id="section-4.1.1-2.2">An "audit path" or "inclusion path" from the member leaf to the merkle root.<a href="#section-4.1.1-2.2" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-4.1.1-3">This section defines a compact binary encoding of these "member proofs" based on approaches developed by Google and others related to "Protocol Buffers".<a href="#section-4.1.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1.1-4">The main feature of protocol buffers which is used is called "varint".<a href="#section-4.1.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1.1-5">This approach is also refered to as <a href="https://en.wikipedia.org/wiki/LEB128">LEB128</a>.<a href="#section-4.1.1-5" class="pilcrow">¶</a></p>
<p id="section-4.1.1-6">This approach is also used in <a href="https://webassembly.github.io/spec/core/binary/values.html">Web Assembly</a><a href="#section-4.1.1-6" class="pilcrow">¶</a></p>
<p id="section-4.1.1-7">This approach is also used in <a href="https://pkg.go.dev/github.com/multiformats/go-varint">multiformats</a>.<a href="#section-4.1.1-7" class="pilcrow">¶</a></p>
<p id="section-4.1.1-8">We remain unaware of a best normative reference to provide for "protocol buffer style varints".<a href="#section-4.1.1-8" class="pilcrow">¶</a></p>
<p id="section-4.1.1-9">See this expired <a href="https://datatracker.ietf.org/doc/html/draft-rfernando-protocol-buffers-00#page-5">internet draft for protocol buffers</a>.<a href="#section-4.1.1-9" class="pilcrow">¶</a></p>
<p id="section-4.1.1-10">See <a href="https://developers.google.com/protocol-buffers">Google's documentation for protocol buffers</a>.<a href="#section-4.1.1-10" class="pilcrow">¶</a></p>
<div id="encoding-of-inclusion-paths">
<section id="section-4.1.1.1">
            <h5 id="name-encoding-of-inclusion-paths">
<a href="#section-4.1.1.1" class="section-number selfRef">4.1.1.1. </a><a href="#name-encoding-of-inclusion-paths" class="section-name selfRef">Encoding of Inclusion Paths</a>
            </h5>
<p id="section-4.1.1.1-1">We describe a binary encoding of an "audit path" or "inclusion path" and a nonce, such that a verifier with a merkle root may confirm that some given "member bytes" are included in a merkle root.<a href="#section-4.1.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1.1.1-2">We define a binary encoded "membership proof" or a given "member" bytes as follows:<a href="#section-4.1.1.1-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-4.1.1.1-3">
              <dt id="section-4.1.1.1-3.1">numberOfAuditHashesProofs</dt>
              <dd style="margin-left: 1.5em" id="section-4.1.1.1-3.2">A positive integer encoded via <code>varint</code>, representing the size of <code>auditDirectionsAsBits</code> and <code>auditHashes</code>.<a href="#section-4.1.1.1-3.2" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-4.1.1.1-3.3">auditDirectionsAsBits</dt>
              <dd style="margin-left: 1.5em" id="section-4.1.1.1-3.4">A binary encoded bitstring representing the directions (left or right) in path from a leaf to a root in a binary merkle tree.<a href="#section-4.1.1.1-3.4" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-4.1.1.1-3.5">memberNonce</dt>
              <dd style="margin-left: 1.5em" id="section-4.1.1.1-3.6">A value derived from a cryptographic hash function and the Root Nonce. This value MUST have the same length as each Hash in <code>auditHashes</code><a href="#section-4.1.1.1-3.6" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-4.1.1.1-3.7">auditHashes</dt>
              <dd style="margin-left: 1.5em" id="section-4.1.1.1-3.8">A series (ordered) of hashes of size determined by the cryptographic hash function chosen, (32 bytes for SHA256).<a href="#section-4.1.1.1-3.8" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
</dl>
<p id="section-4.1.1.1-4">See Test Vectors for specific examples.<a href="#section-4.1.1.1-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="encoding-membership-proofs">
<section id="section-4.1.2">
          <h4 id="name-encoding-membership-proofs">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-encoding-membership-proofs" class="section-name selfRef">Encoding Membership Proofs</a>
          </h4>
<p id="section-4.1.2-1">We describe a binary encoding of a Root Nonce, Merkle Root, and series (order matters) of "audit path" or "inclusion paths".<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
<p id="section-4.1.2-2">These values are encoded via a convention of <code>varint(length of bytes) + bytes</code>.<a href="#section-4.1.2-2" class="pilcrow">¶</a></p>
<p id="section-4.1.2-3">This is to support hash functions of varying lengths and member proofs of varying lengths.<a href="#section-4.1.2-3" class="pilcrow">¶</a></p>
<div id="full-disclosure">
<section id="section-4.1.2.1">
            <h5 id="name-full-disclosure">
<a href="#section-4.1.2.1" class="section-number selfRef">4.1.2.1. </a><a href="#name-full-disclosure" class="section-name selfRef">Full Disclosure</a>
            </h5>
<p id="section-4.1.2.1-1">We define a <code>Full Disclosure</code> membership proof as the result of compression (under zlib v1.2.8) of the following:<a href="#section-4.1.2.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-4.1.2.1-2">
              <dt id="section-4.1.2.1-2.1">rootNonce</dt>
              <dd style="margin-left: 1.5em" id="section-4.1.2.1-2.2">A value produced by the chosen cryptographic hash function applied to some source of randomness. See <a href="#name-randomness-considerations">Randomness considerations</a>. This value is encoded as varint (root nonce length in bytes) + root nonce bytes.<a href="#section-4.1.2.1-2.2" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-4.1.2.1-2.3">root</dt>
              <dd style="margin-left: 1.5em" id="section-4.1.2.1-2.4">A merkle root defined from a binary merkle tree composed of members derived from the hash of the member bytes and the <code>memberNonce</code>. See <a href="#name-tree-construction">Tree Construction</a>. This value is encoded as varint (root length in bytes) + root bytes.<a href="#section-4.1.2.1-2.4" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
<dt id="section-4.1.2.1-2.5">membershipProofs</dt>
              <dd style="margin-left: 1.5em" id="section-4.1.2.1-2.6">A series of "membership proof" bytes, encoded under the scheme: varint (member proof length in bytes) + member proof bytes.<a href="#section-4.1.2.1-2.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
</dl>
<p id="section-4.1.2.1-3">When decoding first the <code>rootNonce</code> and <code>root</code> are removed using varint decoding.<a href="#section-4.1.2.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1.2.1-4">Then the remaining bytes are reduces by appling varint decoded to obtain the individual member proofs.<a href="#section-4.1.2.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1.2.1-5">The compressed representations MUST NOT encode the original member bytes.<a href="#section-4.1.2.1-5" class="pilcrow">¶</a></p>
<p id="section-4.1.2.1-6">The order of member bytes MUST be preserved in some external data structure, in order to suppor full disclosure proof verification.<a href="#section-4.1.2.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="selective-disclosure">
<section id="section-4.1.2.2">
            <h5 id="name-selective-disclosure">
<a href="#section-4.1.2.2" class="section-number selfRef">4.1.2.2. </a><a href="#name-selective-disclosure" class="section-name selfRef">Selective Disclosure</a>
            </h5>
<p id="section-4.1.2.2-1">We define <code>Selective Disclosure</code> the same as <code>Full Disclosure</code> with the exception that the <code>rootNonce</code>
MUST NOT be encoded in the compressed representation.<a href="#section-4.1.2.2-1" class="pilcrow">¶</a></p>
<p id="section-4.1.2.2-2">The <code>rootNonce</code> MUST be ommited in order to ensure that a selective disclosure proof does not reveal information that can be used to brute force siblings of disclosed members. This attack is also refered to as a second pre-image attack, See <a href="#name-disclosure-of-root-nonce">Disclosure of Root Nonce</a>.<a href="#section-4.1.2.2-2" class="pilcrow">¶</a></p>
<p id="section-4.1.2.2-3">We recommend never transmitting the full disclosure proof, and instead deriving a selective disclosure proof even for the full disclosure use case.<a href="#section-4.1.2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="authenticated-full-disclosure-proof">
<section id="section-4.2">
        <h3 id="name-authenticated-full-disclosu">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-authenticated-full-disclosu" class="section-name selfRef">Authenticated Full Disclosure Proof</a>
        </h3>
<p id="section-4.2-1">In order to provide an "issuer" with the capability to provide a set of verifiable claims about a subject, a digital signature over a merkle root and some meta data can be applied.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">We distinguish this data structure from a <code>Full Disclosure Proof</code> by definition.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-4.2-3">
          <dt id="section-4.2-3.1">Authenticated Full Disclosure Proof</dt>
          <dd style="margin-left: 1.5em" id="section-4.2-3.2">An encoding of a digital signature over a merkle proot and meta data, encoded next to a <code>Full Disclosure Proof</code>.<a href="#section-4.2-3.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-4.2-4">Under this scheme a verifier MUST first, verify the signature by obtaining the associated public key from the meta data.<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<p id="section-4.2-5">If the signature is valid, the verifier MUST second, verify all members of the disclosed proof have a corresponding encoded member proof.<a href="#section-4.2-5" class="pilcrow">¶</a></p>
<p id="section-4.2-6">If all members have a proof and the merkle root has a signature that is verified by the public key dereferenced by from the meta data we say:<a href="#section-4.2-6" class="pilcrow">¶</a></p>
<p id="section-4.2-7">The issuer has provided a full disclosure proof for the encoded members.<a href="#section-4.2-7" class="pilcrow">¶</a></p>
<p id="section-4.2-8">In other words, the issuer claims the members are in a set, and this claim can be verified as originating from the issuer and not having been tampered with under the assumption that the issuer's signing keys have not been compromised.<a href="#section-4.2-8" class="pilcrow">¶</a></p>
<p id="section-4.2-9">For a more formal definition of digital signature verification see <span>[<a href="#RFC7515" class="xref">RFC7515</a>]</span> and <span>[<a href="#RFC7797" class="xref">RFC7797</a>]</span>.<a href="#section-4.2-9" class="pilcrow">¶</a></p>
<div id="jose">
<section id="section-4.2.1">
          <h4 id="name-jose">
<a href="#section-4.2.1" class="section-number selfRef">4.2.1. </a><a href="#name-jose" class="section-name selfRef">JOSE</a>
          </h4>
<p id="section-4.2.1-1">TODO: We are discussing JSON encodings of Authenticated Full Disclosure proofs <a href="https://github.com/json-web-proofs/json-web-proofs/issues/15">here</a>.<a href="#section-4.2.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cose">
<section id="section-4.2.2">
          <h4 id="name-cose">
<a href="#section-4.2.2" class="section-number selfRef">4.2.2. </a><a href="#name-cose" class="section-name selfRef">COSE</a>
          </h4>
<p id="section-4.2.2-1">TODO: We are ommiting COSE encodings until JWP is on a standards track.<a href="#section-4.2.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="authenticated-selective-disclosure-proof">
<section id="section-4.3">
        <h3 id="name-authenticated-selective-dis">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-authenticated-selective-dis" class="section-name selfRef">Authenticated Selective Disclosure Proof</a>
        </h3>
<p id="section-4.3-1">Similar to the <code>Authenticated Full Disclosure Proof</code> we define an Authenticated Selective Disclosure by definition:<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-4.3-2">
          <dt id="section-4.3-2.1">Authenticated Selective Disclosure Proof</dt>
          <dd style="margin-left: 1.5em" id="section-4.3-2.2">An encoding of a digital signature over a merkle proot and meta data, encoded next to a <code>Selective Disclosure Proof</code>.<a href="#section-4.3-2.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-4.3-3">We note that a <code>Selective Disclosure Proof</code> MUST be derived from an associated <code>Full Disclosure Proof</code>.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.3-4">This derivation process omits the <code>rootNonce</code> and filter the associated <code>member proofs</code>.<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<p id="section-4.3-5">We refer to the set of disclosed members proofs as:<a href="#section-4.3-5" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-4.3-6">
          <dt id="section-4.3-6.1">Disclosed Member Series</dt>
          <dd style="margin-left: 1.5em" id="section-4.3-6.2">A series (order matters) of membership proofs for a given merkle root.<a href="#section-4.3-6.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-4.3-6.3">Redacted Member Series</dt>
          <dd style="margin-left: 1.5em" id="section-4.3-6.4">A series (order matters) of membership proofs which were present in the original <code>Full Disclosure Proof</code>, but are ommited in the <code>Selective Disclosure Proof</code>.<a href="#section-4.3-6.4" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-4.3-7">We note that the <code>Redacted Member Series</code> may have size 0, however the absence of the <code>rootNonce</code> still differentiates the <code>Authenticated Selective Disclosure Proof</code> from an <code>Authenticated Full Disclosure Proof</code>.<a href="#section-4.3-7" class="pilcrow">¶</a></p>
<div id="jose-1">
<section id="section-4.3.1">
          <h4 id="name-jose-2">
<a href="#section-4.3.1" class="section-number selfRef">4.3.1. </a><a href="#name-jose-2" class="section-name selfRef">JOSE</a>
          </h4>
<p id="section-4.3.1-1">TODO: We are discussing JSON encodings of Authenticated Selective Disclosure proofs <a href="https://github.com/json-web-proofs/json-web-proofs/issues/15">here</a>.<a href="#section-4.3.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cose-1">
<section id="section-4.3.2">
          <h4 id="name-cose-2">
<a href="#section-4.3.2" class="section-number selfRef">4.3.2. </a><a href="#name-cose-2" class="section-name selfRef">COSE</a>
          </h4>
<p id="section-4.3.2-1">TODO: We are ommiting COSE encodings until JWP is on a standards track.<a href="#section-4.3.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-5">
      <h2 id="name-security-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="validating-public-keys">
<section id="section-5.1">
        <h3 id="name-validating-public-keys">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-validating-public-keys" class="section-name selfRef">Validating Public Keys</a>
        </h3>
<p id="section-5.1-1">All algorithms that operate on public keys require first validating those keys.
We assume all keys are represented according to <span>[<a href="#RFC7517" class="xref">RFC7517</a>]</span>.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">Implementers are warned to consider base64url padding concerns.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="disclosure-of-root-nonce">
<section id="section-5.2">
        <h3 id="name-disclosure-of-root-nonce">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-disclosure-of-root-nonce" class="section-name selfRef">Disclosure of Root Nonce</a>
        </h3>
<p id="section-5.2-1">If the root nonce associated with a merkle root is disclosed, a verifier or attacker can compute adjacent membership proofs from sets of disclosed proofs.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="forgery-attacks-on-unbalanced-binary-merkle-trees">
<section id="section-5.3">
        <h3 id="name-forgery-attacks-on-unbalanc">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-forgery-attacks-on-unbalanc" class="section-name selfRef">Forgery Attacks on Unbalanced Binary Merkle Trees</a>
        </h3>
<p id="section-5.3-1">When a binary merkle tree is unbalanced (last level leaf count is not a power of 2), there is a potential for a forgery attack.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">See <a href="https://bitcointalk.org/?topic=102395">CVE-2012-2459</a>.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<p id="section-5.3-3">We remain unable to prove that our salting approach mitigates this potential vulnerability, as such the question remains:<a href="#section-5.3-3" class="pilcrow">¶</a></p>
<blockquote id="section-5.3-4">
          <p id="section-5.3-4.1">does salting members before construction prevent forgery attacks on unbalanced binary merkle trees?<a href="#section-5.3-4.1" class="pilcrow">¶</a></p>
</blockquote>
<p id="section-5.3-5">A note that <span>[<a href="#RFC9162" class="xref">RFC9162</a>]</span> <a href="https://datatracker.ietf.org/doc/html/rfc9162#section-2.1.1">constructs merkle tree's differently</a>.<a href="#section-5.3-5" class="pilcrow">¶</a></p>
<p id="section-5.3-6">See issue <a href="https://github.com/w3c-ccg/Merkle-Disclosure-2021/issues/4">#4</a>.<a href="#section-5.3-6" class="pilcrow">¶</a></p>
<p id="section-5.3-7">See issue <a href="https://github.com/w3c-ccg/Merkle-Disclosure-2021/issues/3">#3</a>.<a href="#section-5.3-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="side-channel-attacks">
<section id="section-5.4">
        <h3 id="name-side-channel-attacks">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-side-channel-attacks" class="section-name selfRef">Side Channel Attacks</a>
        </h3>
<p id="section-5.4-1">Implementations of the signing algorithm SHOULD protect the secret key from side-channel attacks. One method for protecting against certain side-channel attacks is ensuring that the implementation executes exactly the same sequence of instructions and performs exactly the same memory accesses, for any value of the secret key. ( this copied verbatum from <a href="https://raw.githubusercontent.com/mattrglobal/bbs-signatures-spec/master/spec.md">here</a>).<a href="#section-5.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="randomness-considerations">
<section id="section-5.5">
        <h3 id="name-randomness-considerations">
<a href="#section-5.5" class="section-number selfRef">5.5. </a><a href="#name-randomness-considerations" class="section-name selfRef">Randomness Considerations</a>
        </h3>
<p id="section-5.5-1">It is recommended that the all nonces are from a trusted source of randomness AND all randomness is used for a single purpose.<a href="#section-5.5-1" class="pilcrow">¶</a></p>
<p id="section-5.5-2">For example, do not reuse randomness associated with Root Nonce for anything else.<a href="#section-5.5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="choice-of-hash-primitive">
<section id="section-5.6">
        <h3 id="name-choice-of-hash-primitive">
<a href="#section-5.6" class="section-number selfRef">5.6. </a><a href="#name-choice-of-hash-primitive" class="section-name selfRef">Choice of Hash Primitive</a>
        </h3>
<p id="section-5.6-1">The disclosure proofs defined herin rely on "Merkle Audit Paths" which are built from binary merkle trees under a chose hash function.<a href="#section-5.6-1" class="pilcrow">¶</a></p>
<p id="section-5.6-2">The choice of the hash function such as SHA-256 or SHAKE-256 is out of scope for this specification.<a href="#section-5.6-2" class="pilcrow">¶</a></p>
<p id="section-5.6-3">However, at the time of publishing we recommend a cryptographic hash function with at least 256-bit security strength.<a href="#section-5.6-3" class="pilcrow">¶</a></p>
<p id="section-5.6-4">Implementers are advised to consult:<a href="#section-5.6-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.6-5.1">
            <span>[<a href="#RFC8702" class="xref">RFC8702</a>]</span><a href="#section-5.6-5.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.6-5.2">
            <span>[<a href="#RFC4634" class="xref">RFC4634</a>]</span><a href="#section-5.6-5.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.6-5.3">
            <a href="https://csrc.nist.rip/external/nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-185.pdf">NIST SP 800-185</a><a href="#section-5.6-5.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="choice-of-signature-primitive">
<section id="section-5.7">
        <h3 id="name-choice-of-signature-primiti">
<a href="#section-5.7" class="section-number selfRef">5.7. </a><a href="#name-choice-of-signature-primiti" class="section-name selfRef">Choice of Signature Primitive</a>
        </h3>
<p id="section-5.7-1">Alone a Full Disclosure Proof can only prove membership, and is subject to tampering.<a href="#section-5.7-1" class="pilcrow">¶</a></p>
<p id="section-5.7-2">When combined with digital signature schemes, authentication is achievable.<a href="#section-5.7-2" class="pilcrow">¶</a></p>
<p id="section-5.7-3">The choice of the signature scheme such as ES256K or EdDSA is out of scope for this specification.<a href="#section-5.7-3" class="pilcrow">¶</a></p>
<p id="section-5.7-4">Implementers are advised to consult:<a href="#section-5.7-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.7-5.1">
            <a href="https://www.iana.org/assignments/jose/jose.xhtml">IANA JOSE Registry</a><a href="#section-5.7-5.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.7-5.2">
            <a href="https://csrc.nist.gov/publications/detail/fips/186/5/draft">FIPS 186-5</a><a href="#section-5.7-5.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.7-5.3">
            <a href="https://safecurves.cr.yp.to/">safecurves.cr.yp.to</a><a href="#section-5.7-5.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-6">
      <h2 id="name-iana-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-6-1">The following has NOT YET been added to the "JSON Web Proof Algorithm Types" registry:<a href="#section-6-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-6-2.1">Algorithm Name: "ES256+MDSHA256"<a href="#section-6-2.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-2.2">Algorithm Description: ECDSA under P-256 (secp256r1) with binary merkle trees under SHA-256.<a href="#section-6-2.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-2.3">Algorithm Usage Location(s): "alg"<a href="#section-6-2.3" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-2.4">JOSE Implementation Requirements: Optional<a href="#section-6-2.4" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-2.5">Change Controller: IESG<a href="#section-6-2.5" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-2.6">Specification Document(s): Section of this document (RFC TBD)<a href="#section-6-2.6" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-2.7">Algorithm Analysis Documents(s): [RFC TBD]<a href="#section-6-2.7" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-6-3"><br></p>
<ul class="compact">
<li class="compact" id="section-6-4.1">Algorithm Name: "ES256K+MDSHA256"<a href="#section-6-4.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-4.2">Algorithm Description: ECDSA under Secp256k1 (bitcoin and ethereum curve) with binary merkle trees under SHA-256.<a href="#section-6-4.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-4.3">Algorithm Usage Location(s): "alg"<a href="#section-6-4.3" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-4.4">JOSE Implementation Requirements: Optional<a href="#section-6-4.4" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-4.5">Change Controller: IESG<a href="#section-6-4.5" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-4.6">Specification Document(s): Section of this document (RFC TBD)<a href="#section-6-4.6" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-4.7">Algorithm Analysis Documents(s): [RFC TBD]<a href="#section-6-4.7" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-6-5"><br></p>
<ul class="compact">
<li class="compact" id="section-6-6.1">Algorithm Name: "EdDSA+MDSHA256"<a href="#section-6-6.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-6.2">Algorithm Description: EdDSA under Ed25519 with binary merkle trees under SHA-256.<a href="#section-6-6.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-6.3">Algorithm Usage Location(s): "alg"<a href="#section-6-6.3" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-6.4">JOSE Implementation Requirements: Optional<a href="#section-6-6.4" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-6.5">Change Controller: IESG<a href="#section-6-6.5" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-6.6">Specification Document(s): Section of this document (RFC TBD)<a href="#section-6-6.6" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-6-6.7">Algorithm Analysis Documents(s): [RFC TBD]<a href="#section-6-6.7" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="appendix">
<section id="section-7">
      <h2 id="name-appendix">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-appendix" class="section-name selfRef">Appendix</a>
      </h2>
<ul class="compact">
<li class="compact" id="section-7-1.1">JSON Web Signature (JWS) - <a href="https://tools.ietf.org/html/rfc7515">RFC7515</a><a href="#section-7-1.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-7-1.2">JSON Web Encryption (JWE) - <a href="https://tools.ietf.org/html/rfc7516">RFC7516</a><a href="#section-7-1.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-7-1.3">JSON Web Key (JWK) - <a href="https://tools.ietf.org/html/rfc7517">RFC7517</a><a href="#section-7-1.3" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-7-1.4">JSON Web Algorithms (JWA) - <a href="https://tools.ietf.org/html/rfc7518">RFC7518</a><a href="#section-7-1.4" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-7-1.5">JSON Web Token (JWT) - <a href="https://tools.ietf.org/html/rfc7519">RFC7519</a><a href="#section-7-1.5" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-7-1.6">JSON Web Key Thumbprint - <a href="https://tools.ietf.org/html/rfc7638">RFC7638</a><a href="#section-7-1.6" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-7-1.7">JWS Unencoded Payload Option - <a href="https://tools.ietf.org/html/rfc7797">RFC7797</a><a href="#section-7-1.7" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-7-1.8">CFRG Elliptic Curve ECDH and Signatures - <a href="https://tools.ietf.org/html/rfc8037">RFC8037</a><a href="#section-7-1.8" class="pilcrow">¶</a>
</li>
      </ul>
<div id="test-vectors">
<section id="section-7.1">
        <h3 id="name-test-vectors">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-test-vectors" class="section-name selfRef">Test Vectors</a>
        </h3>
<p id="section-7.1-1">//TODO<a href="#section-7.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<section id="section-8">
      <h2 id="name-normative-references">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
      <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4634">[RFC4634]</dt>
      <dd>
<span class="refAuthor">Eastlake 3rd, D.</span> and <span class="refAuthor">T. Hansen</span>, <span class="refTitle">"US Secure Hash Algorithms (SHA and HMAC-SHA)"</span>, <span class="seriesInfo">RFC 4634</span>, <span class="seriesInfo">DOI 10.17487/RFC4634</span>, <time datetime="2006-07" class="refDate">July 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4634">https://www.rfc-editor.org/info/rfc4634</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7515">[RFC7515]</dt>
      <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Bradley, J.</span>, and <span class="refAuthor">N. Sakimura</span>, <span class="refTitle">"JSON Web Signature (JWS)"</span>, <span class="seriesInfo">RFC 7515</span>, <span class="seriesInfo">DOI 10.17487/RFC7515</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7515">https://www.rfc-editor.org/info/rfc7515</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7517">[RFC7517]</dt>
      <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refTitle">"JSON Web Key (JWK)"</span>, <span class="seriesInfo">RFC 7517</span>, <span class="seriesInfo">DOI 10.17487/RFC7517</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7517">https://www.rfc-editor.org/info/rfc7517</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7693">[RFC7693]</dt>
      <dd>
<span class="refAuthor">Saarinen, M-J., Ed.</span> and <span class="refAuthor">J-P. Aumasson</span>, <span class="refTitle">"The BLAKE2 Cryptographic Hash and Message Authentication Code (MAC)"</span>, <span class="seriesInfo">RFC 7693</span>, <span class="seriesInfo">DOI 10.17487/RFC7693</span>, <time datetime="2015-11" class="refDate">November 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7693">https://www.rfc-editor.org/info/rfc7693</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7797">[RFC7797]</dt>
      <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refTitle">"JSON Web Signature (JWS) Unencoded Payload Option"</span>, <span class="seriesInfo">RFC 7797</span>, <span class="seriesInfo">DOI 10.17487/RFC7797</span>, <time datetime="2016-02" class="refDate">February 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7797">https://www.rfc-editor.org/info/rfc7797</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8702">[RFC8702]</dt>
      <dd>
<span class="refAuthor">Kampanakis, P.</span> and <span class="refAuthor">Q. Dang</span>, <span class="refTitle">"Use of the SHAKE One-Way Hash Functions in the Cryptographic Message Syntax (CMS)"</span>, <span class="seriesInfo">RFC 8702</span>, <span class="seriesInfo">DOI 10.17487/RFC8702</span>, <time datetime="2020-01" class="refDate">January 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8702">https://www.rfc-editor.org/info/rfc8702</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9162">[RFC9162]</dt>
    <dd>
<span class="refAuthor">Laurie, B.</span>, <span class="refAuthor">Messeri, E.</span>, and <span class="refAuthor">R. Stradling</span>, <span class="refTitle">"Certificate Transparency Version 2.0"</span>, <span class="seriesInfo">RFC 9162</span>, <span class="seriesInfo">DOI 10.17487/RFC9162</span>, <time datetime="2021-12" class="refDate">December 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9162">https://www.rfc-editor.org/info/rfc9162</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Orie Steele</span></div>
<div dir="auto" class="left"><span class="org">Transmute</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:orie@transmute.industries" class="email">orie@transmute.industries</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Michael Prorock</span></div>
<div dir="auto" class="left"><span class="org">mesur.io</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mprorock@mesur.io" class="email">mprorock@mesur.io</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
